<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script type="text/JavaScript">
      window.onload = function(){
        // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
        // We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser

        //INBOX
        document.getElementById('inbox').innerHTML = "Inbox: " + geemails.length;

        //CURRENT DATE+TIME
        var tmonth=new Array("January","February","March","April","May","June","July","August","September","October","November","December");

        function GetClock(){
        var d=new Date();
        var nmonth=d.getMonth(),ndate=d.getDate(),nyear=d.getYear();
        if(nyear<1000) nyear+=1900;

        var nhour=d.getHours(),nmin=d.getMinutes(),ap;
        if(nhour==0){ap=" AM";nhour=12;}
        else if(nhour<12){ap=" AM";}
        else if(nhour==12){ap=" PM";}
        else if(nhour>12){ap=" PM";nhour-=12;}

        if(nmin<=9) nmin="0"+nmin;

        document.getElementById('clockbox').innerHTML=""+tmonth[nmonth]+" "+ndate+", "+nyear+" "+nhour+":"+nmin+ap+"";
        }

        GetClock();
        setInterval(GetClock,1000);

        //MESSAGES
        var addMailId = document.getElementById('messages').getElementsByTagName('tbody')[0];
        var newRow = addMailId.insertRow(addMailId.rows.length);
        var newCell;
        var newText; 
        var newDiv;
        var currMsg = geemails;
        for(var i = 0; i < currMsg.length; i++) {
            addMail(currMsg[i]);
        }

        function addMail(email) {
                    newCell = newRow.insertCell(0);
                    newText = document.createTextNode(email.date);
                    newCell.appendChild(newText);

                    newCell = newRow.insertCell(1);
                    newText = document.createTextNode(email.sender);
                    newCell.appendChild(newText);

                    newCell = newRow.insertCell(2);
                    newText = document.createTextNode(email.subject);
                    newCell.appendChild(newText);

                    newRow.onclick = function () {
                        alert(email.body);
                    }

                    newRow = addMailId.insertRow(addMailId.rows.length);
        }

        function clearTable() {
            while(addMailId.rows.length > 1) {
                addMailId.deleteRow(0);
            }
        }

        //INBOX BUTTON
        var emailNum = currMsg.length;
        setInterval(function () {
            var inboxButton = document.getElementById("inboxbtn");
            inboxButton.onclick = function() {
                alert("You got mail!");

                currMsg[currMsg.length] = getNewMessage();
                addMail(currMsg[currMsg.length-1]);
                emailNum++;

                document.getElementById('inbox').innerHTML = "Inbox: " + emailNum;
            }
        }, 1000);

        //DATE SORT
        var dateButton = document.getElementById("datebtn");
        dateButton.onclick = function() {
            var sortedDate = currMsg;
            sortedDate.sort(function(a, b) {
                var dateA = new Date(a.date), dateB = new Date(b.date);
                return dateA-dateB;
            });

            clearTable();

            for(var i = 0; i < sortedDate.length; i++) {
                addMail(sortedDate[i]);
            }
        }

        //SENDER SORT
        var senderButton = document.getElementById("senderbtn");
        senderButton.onclick = function() {
            var sortedSender = currMsg;
            function sendAsc(a, b) {
                var nameA = a.sender.toLowerCase(), nameB = b.sender.toLowerCase();
                if (nameA < nameB) return -1;
                else if (nameA > nameB) return 1;
                else return 0;
            };
            sortedSender.sort(sendAsc);
            clearTable();

            for(var i = 0; i < sortedSender.length; i++) {
                addMail(sortedSender[i]);
            }
        }

        //SUBJECT SORT
        var subjectButton = document.getElementById("subjectbtn");
        subjectButton.onclick = function() {
            var sortedSubject = currMsg;
            function subAsc(a, b) {
                var subA = a.subject.toLowerCase(), subB = b.subject.toLowerCase();
                if (subA < subB) return -1;
                else if (subA > subB) return 1;
                else return 0;
            };
            sortedSubject.sort(subAsc);
            clearTable();

            for(var i = 0; i < sortedSubject.length; i++) {
                addMail(sortedSubject[i]);
            }
        }

        var helpButton = document.getElementById("help");
        helpButton.onclick = function() {
            alert("- To view an email simply click on the specified e-mail\n- To view/update e-mails click the red inbox button\n- To view e-mails in ascending order simply click any of the categories (i.e, by sender)");
        }

      };
    </script>

    <title>GeeMail</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"> 
	</head>
	<body>
		<div class="container" id="main">
			<div class="talk-bubble tri-right round btm-left" id="inboxbtn">
			  <div class="talktext">
			    <p id="inbox"></p>
			  </div>
			</div>
			<h1>GEEMAIL,</h1><br>
			<span id="clockbox"></span>
			<br>
			<br>
			<div align="center">
			<table id="messages">
			  <thead>
			    <tr>
			      <th id="datebtn" bgcolor="#f5f5f5">Date</th>
			      <th id="senderbtn" bgcolor="#f5f5f5">Sender</th>
			      <th id="subjectbtn" bgcolor="#f5f5f5">Subject</th>
			    </tr>
			  </thead>
			  <tbody>
			  </tbody>
			</table>
			</div>
		</div>
        <footer><div id="help">Need help?</div></footer>
	</body>
</html>